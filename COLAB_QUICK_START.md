# Colab QLoRA 训练快速开始指南

## ? 5 分钟开始训练

### 第 1 步：打开 Colab
访问：https://colab.research.google.com

### 第 2 步：创建新笔记本
点击"文件" → "新建笔记本"

### 第 3 步：设置 GPU
1. 点击"运行时" → "更改运行时类型"
2. 硬件加速器：选择"T4 GPU"（或更好的 GPU）
3. 点击"保存"

### 第 4 步：复制训练代码
打开本地文件：`colab_qlora_training_cells_final.txt`

将每个单元格的代码复制到 Colab 中（共 7 个单元格）

### 第 5 步：按顺序执行

```
? 单元格 1：环境准备（2-3 分钟）
   - 挂载 Google Drive
   - 安装依赖（修复版）

? 单元格 2：克隆代码（30 秒）
   - 从 GitHub 克隆项目

? 单元格 3：生成指令集（1-2 分钟）
   - 从数据库提取 300 条样本
   - 如果数据库不存在，使用模板数据

? 单元格 4：开始训练（2-4 小时）
   - QLoRA 微调 Deepseek-7B
   - 保持页面打开

? 单元格 5：验证结果（10 秒）
   - 检查输出文件

? 单元格 6：测试模型（2-3 分钟）
   - 加载微调后的模型
   - 运行测试案例

? 单元格 7：备份模型（可选，1 分钟）
   - 备份到 Drive 其他位置
```

---

## ?? 重要提示

### 数据库文件位置
确保数据库文件在以下位置之一：
- `/content/drive/MyDrive/Graduation_Project/datasets/finance_analysis.db`
- 或者不上传数据库，使用模板数据（120条指令）

### 保持连接
训练需要 2-4 小时，请：
- ? 保持 Colab 页面打开
- ? 保持电脑不休眠
- ? 保持网络连接稳定

### GPU 选择
| GPU 类型 | 训练时间 | 推荐度 |
|---------|---------|--------|
| T4      | 3-4 小时 | ??? 免费可用 |
| V100    | 2-3 小时 | ???? 需要 Colab Pro |
| A100    | 1-2 小时 | ????? 需要 Colab Pro+ |

---

## ? 检查点

### 单元格 1 成功标志
```
? 环境准备完成
? 依赖版本：
Name: bitsandbytes
Version: 0.43.1
```

### 单元格 3 成功标志
```
? 数据库已存在
? 脚本修复完成
...
总样本数: 300  # 或 120（使用模板数据）
```

### 单元格 4 成功标志
```
Epoch 1/3: 100%|| 75/75
Epoch 2/3: 100%|| 75/75
Epoch 3/3: 100%|| 75/75
? 训练完成
```

### 单元格 5 成功标志
```
? adapter_model.bin (50-100 MB)
? adapter_config.json
? training_info.json
```

---

## ? 常见问题

### Q1: 单元格 1 报错 "No module named 'triton.ops'"
**A**: 这是旧版本的问题，新版本已修复。确保使用 `colab_qlora_training_cells_final.txt`

### Q2: 单元格 3 报错 "no such column: ei.ret_post_15"
**A**: 这是旧版本的问题，新版本已修复。单元格 3 会自动修复脚本。

### Q3: 单元格 4 报错 "CUDA out of memory"
**A**: 显存不足，修改训练参数：
```python
--batch_size 2      # 从 4 改为 2
--max_length 256    # 从 512 改为 256
```

### Q4: 训练中断了怎么办？
**A**: 重新运行单元格 4，训练会从头开始（QLoRA 训练较快，2-4小时）

### Q5: 没有数据库文件怎么办？
**A**: 不影响训练！单元格 3 会自动使用模板数据生成 120 条指令，足够演示效果。

---

## ? 预期结果

### 训练完成后的文件
```
/content/drive/MyDrive/Graduation_Project/qlora_output/
├── adapter_model.bin       (50-100 MB)  # LoRA 权重
├── adapter_config.json     (1 KB)       # LoRA 配置
└── training_info.json      (1 KB)       # 训练信息
```

### 模型效果示例
```
Input: 美联储宣布加息25个基点，符合市场预期

Output: 这是一条高星级的财经快讯，属于利空消息。
从市场反应来看，该消息发布后市场出现下跌走势。
建议投资者关注后续市场反应，结合技术面和基本面综合判断。
```

---

## ? 完成后的操作

1. **测试模型**（单元格 6）
   - 验证微调效果
   - 对比微调前后的输出

2. **备份模型**（单元格 7）
   - 保存到 Drive 其他位置
   - 防止意外删除

3. **更新项目文档**
   - 记录训练参数
   - 记录模型效果
   - 更新 `Project_Status.md`

---

## ? 下一步

训练完成后，你可以：

1. **集成到本地系统**
   - 下载 LoRA 权重到本地
   - 在本地 Agent 系统中使用

2. **继续优化**
   - 调整训练参数
   - 增加训练数据
   - 尝试不同的 LoRA 配置

3. **准备答辩**
   - 展示微调效果
   - 对比微调前后的差异
   - 说明 QLoRA 的优势

---

## ? 需要帮助？

如果遇到问题：
1. 查看 `COLAB_QLORA_FIX_SUMMARY.md` 了解详细修复说明
2. 检查错误信息，对照"常见问题"部分
3. 将错误信息反馈给我

---

**祝训练顺利！?**
